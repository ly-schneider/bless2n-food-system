collection:
  get:
    tags: [Invites]
    summary: List invites
    operationId: listInvites
    security:
      - sessionAuth: []
    x-required-permissions: [invites:manage]
    parameters:
      - name: status
        in: query
        schema:
          $ref: '../schemas/invites.yaml#/InviteStatus'
      - name: email
        in: query
        description: Filter by invitee email
        schema:
          type: string
    responses:
      '200':
        description: Invite list
        content:
          application/json:
            schema:
              $ref: '../schemas/invites.yaml#/InviteList'
      '401':
        description: Authentication required
        content:
          application/json:
            schema:
              $ref: '../schemas/common.yaml#/Error'
      '403':
        description: Insufficient permissions
        content:
          application/json:
            schema:
              $ref: '../schemas/common.yaml#/Error'

  post:
    tags: [Invites]
    summary: Create invite
    description: |
      Creates an admin invite and sends the invitation email.
      The invite token is valid for 7 days (configurable, max 30 days).
    operationId: createInvite
    security:
      - sessionAuth: []
    x-required-permissions: [invites:manage]
    requestBody:
      required: true
      content:
        application/json:
          schema:
            $ref: '../schemas/invites.yaml#/InviteCreate'
          example:
            email: "newadmin@example.com"
    responses:
      '201':
        description: Invite created and email sent
        content:
          application/json:
            schema:
              $ref: '../schemas/invites.yaml#/Invite'
            example:
              id: "019412ab-0000-7000-8000-000000000300"
              inviteeEmail: "newadmin@example.com"
              status: pending
              expiresAt: "2025-02-06T14:30:00Z"
              invitedByUserId: "ba_user_abc123"
              createdAt: "2025-01-30T14:30:00Z"
      '401':
        description: Authentication required
        content:
          application/json:
            schema:
              $ref: '../schemas/common.yaml#/Error'
      '403':
        description: Insufficient permissions
        content:
          application/json:
            schema:
              $ref: '../schemas/common.yaml#/Error'

item:
  parameters:
    - name: inviteId
      in: path
      required: true
      schema:
        type: string
        format: uuid

  get:
    tags: [Invites]
    summary: Get invite (public)
    description: |
      Returns invite details by ID. Used by the invite acceptance page
      to show invite info before the user accepts.
    operationId: getInvite
    security:
      - {}
    responses:
      '200':
        description: Invite details (public view)
        content:
          application/json:
            schema:
              $ref: '../schemas/invites.yaml#/InvitePublic'
      '404':
        description: Resource not found
        content:
          application/json:
            schema:
              $ref: '../schemas/common.yaml#/Error'

  delete:
    tags: [Invites]
    summary: Revoke invite
    operationId: deleteInvite
    security:
      - sessionAuth: []
    x-required-permissions: [invites:manage]
    responses:
      '204':
        description: Invite revoked
      '401':
        description: Authentication required
        content:
          application/json:
            schema:
              $ref: '../schemas/common.yaml#/Error'
      '403':
        description: Insufficient permissions
        content:
          application/json:
            schema:
              $ref: '../schemas/common.yaml#/Error'
      '404':
        description: Resource not found
        content:
          application/json:
            schema:
              $ref: '../schemas/common.yaml#/Error'

verify:
  post:
    tags: [Invites]
    summary: Verify invite token
    description: |
      Verifies an invite token is valid and has not expired.
      Returns the invite details if valid.
    operationId: verifyInvite
    security:
      - {}
    requestBody:
      required: true
      content:
        application/json:
          schema:
            $ref: '../schemas/invites.yaml#/InviteTokenRequest'
          example:
            token: "base64url-encoded-token-string"
    responses:
      '200':
        description: Token is valid
        content:
          application/json:
            schema:
              $ref: '../schemas/invites.yaml#/InvitePublic'
      '400':
        description: Token is invalid or expired
        content:
          application/json:
            schema:
              $ref: '../schemas/common.yaml#/Error'

accept:
  post:
    tags: [Invites]
    summary: Accept invite
    description: |
      Accepts an invite using the token. If the user already exists,
      their role is upgraded to admin. Otherwise, a new admin user
      is created.
    operationId: acceptInvite
    security:
      - {}
    requestBody:
      required: true
      content:
        application/json:
          schema:
            $ref: '../schemas/invites.yaml#/InviteAccept'
          example:
            token: "base64url-encoded-token-string"
            firstName: "Jane"
            lastName: "Doe"
    responses:
      '200':
        description: Invite accepted, user created/upgraded
        content:
          application/json:
            schema:
              $ref: '../schemas/invites.yaml#/InvitePublic'
      '400':
        description: Token invalid, expired, or already used
        content:
          application/json:
            schema:
              $ref: '../schemas/common.yaml#/Error'

---
title: API Referenz
description: REST Endpoints und Contracts für Public, POS und Admin
---

Alle Pfade sind mit `/v1` präfixiert (sofern nicht anders angegeben). Public Base bietet `/health` und `/.well-known/jwks.json`.

# Auth

- `POST /v1/auth/otp/request`: OTP‑Login‑Code per E‑Mail anfordern.
- `POST /v1/auth/otp/verify`: Code verifizieren und JWTs (Access + Refresh) ausstellen.
- `POST /v1/auth/google/code`: Authorization Code + PKCE austauschen (`{ code, code_verifier, redirect_uri, nonce }`).
- `POST /v1/auth/refresh`: Refresh Token rotieren, neues Access Token ausstellen.
- `POST /v1/auth/logout`: Aktuelle Session widerrufen.
- `GET /v1/users/me/sessions`: Aktive Sessions auflisten.
- `DELETE /v1/users/me/sessions/{id}` bzw. `DELETE /v1/users/me/sessions`: Session oder alle widerrufen.

Hinweis: JWT Public Keys unter `/.well-known/jwks.json`.

# Products & Categories

- `GET /v1/products`: Aktive Produkte inkl. Kategorie‑Infos und Verfügbarkeits‑Snapshot.

Admin:

- `GET/POST/PATCH/DELETE /v1/admin/categories`
- `PATCH /v1/admin/products/{id}/price` — Preis in Cents anpassen.
- `PATCH /v1/admin/products/{id}/active` — Aktiv‑Status umschalten.
- `PATCH /v1/admin/products/{id}/category` — Produkt zwischen Kategorien verschieben.
- `POST /v1/admin/products/{id}/inventory-adjust` — Bestand im Ledger anpassen (begründete Delta‑Buchung).
- `DELETE /v1/admin/products/{id}` — Hard Delete.

# Menus (Admin)

- `GET /v1/admin/menus`, `GET /v1/admin/menus/{id}`
- `POST /v1/admin/menus` — Menu‑Produkt mit Slots erstellen.
- `PATCH /v1/admin/menus/{id}` — generisches Update.
- `PATCH /v1/admin/menus/{id}/active` — Aktiv umschalten.
- Slots: erstellen, umbenennen, sortieren, löschen; Items anfügen/entfernen.

# Orders

- `GET /v1/orders` (auth): Eigene Orders auflisten.
- `GET /v1/orders/{id}` (public): Öffentliche Order‑Ansicht (reduzierte Felder).
- `GET /v1/orders/{id}/pickup-qr`: QR‑Inhalt für Abholung.

Admin:

- `GET /v1/admin/orders`, `GET /v1/admin/orders/{id}`
- `GET /v1/admin/orders/export.csv`
- `PATCH /v1/admin/orders/{id}/status` — Status ändern (Cancel/Refund sofern unterstützt).

# Stations & POS

Stations (public):

- `POST /v1/stations/requests`: Station Onboarding anfragen.
- `GET /v1/stations/me`: Station‑Info per Token.
- `POST /v1/stations/verify-qr`: Abhol‑QR prüfen.
- `POST /v1/stations/redeem`: Order Item einlösen.

POS (device‑gated via `X-Pos-Token`):

- `POST /v1/pos/requests`: POS Device Token anfragen.
- `GET /v1/pos/me`: Geräte‑Status.
- `POST /v1/pos/orders`: Order aus Items erstellen.
- `POST /v1/pos/orders/{id}/pay-cash`: Barzahlung anhängen.
- `POST /v1/pos/orders/{id}/pay-card`: Kartenergebnis anhängen (z. B. `{ processor: 'sumup', transactionId, status }`).

Admin POS:

- `GET /v1/admin/pos/requests`, `POST /v1/admin/pos/requests/{id}/approve|reject`
- `GET /v1/admin/pos/devices`, `PATCH /v1/admin/pos/devices/{id}/config`

# Payments (Stripe/TWINT)

- `POST /v1/payments/create-intent`: Body enthält `items` Array; liefert `clientSecret`, `paymentIntentId`, `orderId`.
- `PATCH /v1/payments/attach-email`: E‑Mail vor Bestätigung setzen/löschen.
- `GET /v1/payments/{id}`: Status für Return‑Seite.
- `POST /v1/payments/webhook`: Empfängt Stripe Events; finalisiert Orders.

# Admin Users & Sessions

- `GET /v1/admin/users`, `GET /v1/admin/users/{id}`
- `PATCH /v1/admin/users/{id}` — Profilfelder.
- `PATCH /v1/admin/users/{id}/role` — Rolle setzen.
- `POST /v1/admin/users/{id}/promote` — Legacy Promote.
- `DELETE /v1/admin/users/{id}`
- `GET /v1/admin/sessions` — Refresh Token Families pro User.
- `POST /v1/admin/users/{id}/sessions/revoke`, `/revoke-all`.

# Admin Invites

- `GET/POST/DELETE /v1/admin/invites`, `POST /v1/admin/invites/{id}/revoke|resend`.
- Public: `POST /v1/invites/accept`, `POST /v1/invites/verify`.

# Error Model

- Standard JSON Responses mit `detail` bei Fehlern; Admin‑Mutationen benötigen CSRF Cookie/Header.

# Integration Setup

- Stripe/TWINT: TWINT aktivieren; `STRIPE_SECRET_KEY`, `STRIPE_WEBHOOK_SECRET` setzen; Publishable Key im Frontend.
- Google OAuth: Web Client ID/Secret; Redirect URIs; PKCE und nonce im Frontend.
- SumUp (Android): Affiliate Key in CI; App Login via SDK.
- SMTP/Mailpit: SMTP Host, Port, Username/Password; TLS Policy; Dev nutzt Mailpit UI.
